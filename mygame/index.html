<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>My NFT Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #1a1a1a;
            border-bottom: 1px solid #333333;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #333333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #888888;
        }
        
        .user-name {
            font-size: 16px;
            font-weight: 600;
        }
        
        .currency-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .currency-item {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #2a2a2a;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .plus-btn {
            background: #007AFF;
            border: none;
            border-radius: 20px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        .center-area {
            text-align: center;
            padding: 40px 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #111111;
            border-radius: 16px;
            margin-bottom: 20px;
        }
        
        .center-logo {
            font-size: 64px;
            color: #444444;
            opacity: 0.8;
            font-weight: 300;
        }
        
        .center-nft-img {
            width: 180px;
            height: 180px;
            border-radius: 16px;
            object-fit: cover;
            margin-bottom: 16px;
            border: 2px solid #333333;
        }
        
        .center-nft-name {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .center-nft-status {
            font-size: 16px;
            color: #888888;
            background: #2a2a2a;
            padding: 6px 12px;
            border-radius: 12px;
        }
        
        .play-btn {
            background: #34C759;
            border: none;
            color: white;
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .play-btn:hover {
            background: #30B454;
        }
        
        .play-btn:disabled {
            background: #333333;
            color: #888888;
            cursor: not-allowed;
        }
        
        .bottom-nav {
            display: flex;
            background: #1a1a1a;
            border-top: 1px solid #333333;
        }
        
        .nav-item {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #888888;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: color 0.2s ease;
        }
        
        .nav-item.active {
            color: #007AFF;
        }
        
        .nav-item i {
            font-size: 20px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
        }
        
        .nft-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            border: 1px solid #333333;
        }
        
        .nft-card-img {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 8px;
        }
        
        .nft-card-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .nft-card-price {
            font-size: 12px;
            color: #888888;
            margin-bottom: 8px;
        }
        
        .nft-card-btn {
            background: #007AFF;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 4px;
        }
        
        .nft-card-btn.secondary {
            background: #333333;
            margin-bottom: 0;
        }
        
        /* Battle styles */
        .battle-arena {
            background: #111111;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .battle-participants {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .participant {
            text-align: center;
            flex: 1;
        }
        
        .participant-img {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            object-fit: cover;
            margin-bottom: 12px;
            border: 2px solid #333333;
        }
        
        .participant-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .hp-container {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 8px;
        }
        
        .hp-bar {
            height: 12px;
            background: #d32f2f;
            border-radius: 6px;
            transition: width 0.8s ease;
            position: relative;
        }
        
        .hp-bar.low {
            background: #ff5722;
            animation: pulse 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        
        .hp-text {
            font-size: 14px;
            color: #cccccc;
            font-weight: 600;
        }
        
        .vs-text {
            font-size: 28px;
            font-weight: bold;
            color: #666666;
            margin: 0 20px;
        }
        
        .battle-log {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            font-size: 16px;
            color: #cccccc;
            min-height: 80px;
            border: 1px solid #333333;
            font-weight: 500;
        }
        
        .battle-result {
            text-align: center;
            padding: 24px;
            font-size: 24px;
            font-weight: 700;
        }
        
        .battle-result.win {
            color: #4caf50;
        }
        
        .battle-result.lose {
            color: #f44336;
        }
        
        .reward-info {
            background: #1a472a;
            border: 1px solid #34623f;
            border-radius: 12px;
            padding: 16px;
            margin: 15px 0;
            text-align: center;
            font-size: 16px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: #111111;
            border-radius: 16px;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: #333333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #888888;
        }
        
        .profile-info h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .profile-stats {
            font-size: 14px;
            color: #888888;
        }
        
        .friends-placeholder {
            text-align: center;
            padding: 80px 20px;
            color: #888888;
            font-size: 18px;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">üë§</div>
                <div class="user-name" id="user-name">–ò–≥—Ä–æ–∫</div>
            </div>
            <div class="currency-info">
                <div class="currency-item">
                    <i class="fas fa-star" style="color: #ffd700;"></i>
                    <span id="star-count">0</span>
                </div>
                <button class="plus-btn" onclick="buyStars()">+</button>
                <div class="currency-item">
                    <i class="fas fa-gift" style="color: #ff6b6b;"></i>
                    <span id="gift-count">0</span>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Main Screen -->
            <div id="main-screen" class="screen active">
                <div class="main-content">
                    <div id="center-area" class="center-area">
                        <div id="center-content"></div>
                    </div>
                    <button class="play-btn" id="play-button" onclick="startBattle()">–ë–ò–¢–í–ê</button>
                </div>
            </div>

            <!-- Collection Screen -->
            <div id="collection-screen" class="screen">
                <div class="main-content">
                    <h2 class="section-title">–ö–æ–ª–ª–µ–∫—Ü–∏—è</h2>
                    <div id="collection-grid" class="nft-grid"></div>
                    <button class="play-btn" onclick="openShop()" style="margin-top: 20px;">
                        <i class="fas fa-shopping-cart"></i> –ö—É–ø–∏—Ç—å NFT
                    </button>
                </div>
            </div>

            <!-- Shop Screen -->
            <div id="shop-screen" class="screen">
                <div class="main-content">
                    <h2 class="section-title">–ú–∞–≥–∞–∑–∏–Ω NFT</h2>
                    <div id="shop-grid" class="nft-grid"></div>
                </div>
            </div>

            <!-- Battle Screen -->
            <div id="battle-screen" class="screen">
                <div class="main-content">
                    <h2 class="section-title">–ë–∏—Ç–≤–∞</h2>
                    <div class="battle-arena">
                        <div class="battle-participants">
                            <div class="participant">
                                <img id="player-img" class="participant-img" src="" alt="Player NFT">
                                <div class="participant-name">–í—ã</div>
                                <div class="hp-container">
                                    <div id="player-hp-bar" class="hp-bar"></div>
                                </div>
                                <div id="player-hp-text" class="hp-text">100/100 HP</div>
                            </div>
                            <div class="vs-text">VS</div>
                            <div class="participant">
                                <img id="bot-img" class="participant-img" src="" alt="Bot NFT">
                                <div class="participant-name">–ë–æ—Ç</div>
                                <div class="hp-container">
                                    <div id="bot-hp-bar" class="hp-bar"></div>
                                </div>
                                <div id="bot-hp-text" class="hp-text">100/100 HP</div>
                            </div>
                        </div>
                        <div id="battle-log" class="battle-log">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±–∏—Ç–≤–µ...</div>
                        <div id="battle-result" class="battle-result" style="display: none;"></div>
                        <div id="reward-info" class="reward-info" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Profile Screen -->
            <div id="profile-screen" class="screen">
                <div class="main-content">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">üë§</div>
                        <div class="profile-info">
                            <h2 id="profile-name">–ò–≥—Ä–æ–∫</h2>
                            <div class="profile-stats">
                                <div>NFT –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏: <span id="profile-nft-count">0</span></div>
                                <div>–ó–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="profile-stars-earned">0</span></div>
                            </div>
                        </div>
                    </div>
                    <h3 class="section-title" style="font-size: 18px;">–ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</h3>
                    <div id="profile-collection" class="nft-grid"></div>
                </div>
            </div>

            <!-- Friends Screen -->
            <div id="friends-screen" class="screen">
                <div class="main-content">
                    <div class="friends-placeholder">
                        <h2>Hello World</h2>
                        <p style="margin-top: 20px; color: #666;">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="switchScreen('main')">
                <i class="fas fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button class="nav-item" onclick="switchScreen('collection')">
                <i class="fas fa-box-open"></i>
                <span>–ö–æ–ª–ª–µ–∫—Ü–∏—è</span>
            </button>
            <button class="nav-item" onclick="switchScreen('profile')">
                <i class="fas fa-user"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
            <button class="nav-item" onclick="switchScreen('friends')">
                <i class="fas fa-users"></i>
                <span>–î—Ä—É–∑—å—è</span>
            </button>
        </div>
    </div>

    <script>
        Telegram.WebApp.ready();

        // –î–∞–Ω–Ω—ã–µ NFT
        const nftTemplates = [
            { name: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å', img: 'https://raw.githubusercontent.com/yourusername/yourrepo/main/calendar.gif' },
            { name: 'Doge Pop', img: 'https://raw.githubusercontent.com/yourusername/yourrepo/main/doge.gif' },
            { name: 'Pepe', img: 'https://raw.githubusercontent.com/yourusername/yourrepo/main/pepe.gif' },
            { name: 'Loli Pop', img: 'https://i.getgems.io/Uh4_vqGzSw4MKwPwYEsWI2i6R44t8A7bjly1E4K6IgM/rs:fill:500:500:1/g:ce/czM6Ly9nZXRnZW1zLXMzL25mdC1jb250ZW50LWNhY2hlL2ltYWdlcy9FUUM2emppZDh2Sk5FV3FjWGsxMFhqc2RETFJLYmNQWnpiSHVzdUVXNkZva09XSW0vYzY2YWY5MDRmODg1NmE5OQ' }
        ];
        const nftPrices = [100, 150, 200, 250];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let stars = parseInt(localStorage.getItem('stars')) || 100;
        let collection = JSON.parse(localStorage.getItem('collection')) || [];
        let activeBattleNft = JSON.parse(localStorage.getItem('activeBattleNft')) || null;
        let totalStarsEarned = parseInt(localStorage.getItem('totalStarsEarned')) || 0;
        
        // Telegram user data
        const tgUser = Telegram.WebApp.initDataUnsafe?.user;
        let userName = tgUser?.first_name || '–ò–≥—Ä–æ–∫';
        let userAvatar = tgUser?.photo_url || 'üë§';
        
        // Battle variables
        let playerHP = 100;
        let botHP = 100;
        let botNft = null;
        let battleInProgress = false;
        let currentScreen = 'main';

        init();

        function init() {
            updateUI();
            renderCenterArea();
            renderCollection();
            renderShop();
            renderProfile();
            updateUserInfo();
        }

        function updateUserInfo() {
            document.getElementById('user-name').textContent = userName;
            document.getElementById('profile-name').textContent = userName;
            
            if (typeof userAvatar === 'string' && userAvatar.startsWith('http')) {
                document.getElementById('user-avatar').innerHTML = `<img src="${userAvatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                document.getElementById('profile-avatar').innerHTML = `<img src="${userAvatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
            }
        }

        function updateUI() {
            document.getElementById('star-count').textContent = stars;
            document.getElementById('gift-count').textContent = collection.length;
            document.getElementById('profile-nft-count').textContent = collection.length;
            document.getElementById('profile-stars-earned').textContent = totalStarsEarned;
            localStorage.setItem('stars', stars);
            localStorage.setItem('totalStarsEarned', totalStarsEarned);
            updatePlayButton();
        }

        function updatePlayButton() {
            const playBtn = document.getElementById('play-button');
            if (!activeBattleNft) {
                playBtn.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ NFT –¥–ª—è –±–∏—Ç–≤—ã';
                playBtn.disabled = true;
            } else if (stars < 10) {
                playBtn.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ (10‚≠ê)';
                playBtn.disabled = true;
            } else {
                playBtn.textContent = '–ë–ò–¢–í–ê (10‚≠ê)';
                playBtn.disabled = false;
            }
        }

        function buyStars() {
            stars += 100;
            totalStarsEarned += 100;
            updateUI();
            alert('–ö—É–ø–ª–µ–Ω–æ 100 –∑–≤—ë–∑–¥! (–¢–µ—Å—Ç)');
        }

        function switchScreen(screen) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            
            // Hide all screens
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            
            // Show selected screen
            if (screen === 'main') {
                document.getElementById('main-screen').classList.add('active');
                renderCenterArea();
            } else if (screen === 'collection') {
                document.getElementById('collection-screen').classList.add('active');
                renderCollection();
            } else if (screen === 'profile') {
                document.getElementById('profile-screen').classList.add('active');
                renderProfile();
            } else if (screen === 'friends') {
                document.getElementById('friends-screen').classList.add('active');
            }
            
            currentScreen = screen;
        }

        function openShop() {
            document.getElementById('collection-screen').classList.remove('active');
            document.getElementById('shop-screen').classList.add('active');
            renderShop();
        }

        function backToCollection() {
            document.getElementById('shop-screen').classList.remove('active');
            document.getElementById('collection-screen').classList.add('active');
        }

        function startBattle() {
            if (!activeBattleNft || stars < 10) return;
            
            stars -= 10;
            updateUI();
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π NFT –¥–ª—è –±–æ—Ç–∞
            const randomIndex = Math.floor(Math.random() * nftTemplates.length);
            botNft = { ...nftTemplates[randomIndex] };
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –±–∏—Ç–≤–µ
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('battle-screen').classList.add('active');
            initializeBattle();
        }

        function initializeBattle() {
            playerHP = 100;
            botHP = 100;
            battleInProgress = true;
            
            document.getElementById('player-img').src = activeBattleNft.img;
            document.getElementById('bot-img').src = botNft.img;
            
            updateHPBars();
            
            document.getElementById('battle-result').style.display = 'none';
            document.getElementById('reward-info').style.display = 'none';
            
            const playerFirst = Math.random() < 0.5;
            const log = document.getElementById('battle-log');
            
            if (playerFirst) {
                log.textContent = '‚öîÔ∏è –í—ã –∞—Ç–∞–∫—É–µ—Ç–µ –ø–µ—Ä–≤—ã–º–∏! –ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å...';
                setTimeout(() => performAttack(true), 2000);
            } else {
                log.textContent = 'üõ°Ô∏è –ë–æ—Ç –∞—Ç–∞–∫—É–µ—Ç –ø–µ—Ä–≤—ã–º! –ó–∞—â–∏—â–∞–π—Ç–µ—Å—å...';
                setTimeout(() => performAttack(false), 2000);
            }
        }

        function performAttack(isPlayerTurn) {
            if (!battleInProgress) return;
            
            // –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Ä–æ–Ω–∞ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∞–∑–∞—Ä—Ç–∞
            let damage;
            const isLowHP = (isPlayerTurn ? botHP : playerHP) <= 25;
            const isCritical = Math.random() < (isLowHP ? 0.3 : 0.15); // –ë–æ–ª—å—à–µ —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º HP
            
            if (isCritical) {
                damage = Math.floor(Math.random() * 30) + 45; // 45-75 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω
            } else {
                damage = Math.floor(Math.random() * 35) + 8; // 8-43 –æ–±—ã—á–Ω—ã–π —É—Ä–æ–Ω
            }
            
            // –®–∞–Ω—Å –Ω–∞ "–ø—Ä–æ–º–∞—Ö" –¥–ª—è –¥—Ä–∞–º—ã
            const isMiss = Math.random() < 0.08;
            
            const log = document.getElementById('battle-log');
            
            if (isMiss) {
                if (isPlayerTurn) {
                    log.textContent = 'üí® –ü—Ä–æ–º–∞—Ö! –í–∞—à–∞ –∞—Ç–∞–∫–∞ –Ω–µ –ø–æ–ø–∞–ª–∞ –≤ —Ü–µ–ª—å!';
                } else {
                    log.textContent = 'üõ°Ô∏è –£–∫–ª–æ–Ω–µ–Ω–∏–µ! –í—ã –∏–∑–±–µ–∂–∞–ª–∏ –∞—Ç–∞–∫–∏ –±–æ—Ç–∞!';
                }
            } else {
                if (isPlayerTurn) {
                    botHP = Math.max(0, botHP - damage);
                    if (isCritical) {
                        log.textContent = `üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–î–ê–†! –í—ã –Ω–∞–Ω–æ—Å–∏—Ç–µ ${damage} —É—Ä–æ–Ω–∞ –±–æ—Ç—É!`;
                    } else {
                        log.textContent = `‚öîÔ∏è –í—ã –Ω–∞–Ω–æ—Å–∏—Ç–µ ${damage} —É—Ä–æ–Ω–∞ –±–æ—Ç—É!`;
                    }
                } else {
                    playerHP = Math.max(0, playerHP - damage);
                    if (isCritical) {
                        log.textContent = `üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ê–¢–ê–ö–ê –ë–û–¢–ê! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ ${damage} —É—Ä–æ–Ω–∞!`;
                    } else {
                        log.textContent = `üí¢ –ë–æ—Ç –Ω–∞–Ω–æ—Å–∏—Ç –≤–∞–º ${damage} —É—Ä–æ–Ω–∞!`;
                    }
                }
            }
            
            updateHPBars();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–º–µ–Ω—Ç (–Ω–∏–∑–∫–æ–µ HP)
            if ((playerHP <= 15 || botHP <= 15) && playerHP > 0 && botHP > 0) {
                setTimeout(() => {
                    log.textContent = 'üíÄ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ! –°–ª–µ–¥—É—é—â–∏–π —É–¥–∞—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ—à–∞—é—â–∏–º!';
                }, 1000);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏–µ –±–∏—Ç–≤—ã
            if (playerHP <= 0 || botHP <= 0) {
                setTimeout(() => endBattle(), 2000);
            } else {
                // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
                const delay = Math.random() * 1000 + 1500; // 1.5-2.5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => performAttack(!isPlayerTurn), delay);
            }
        }

        function updateHPBars() {
            const playerBar = document.getElementById('player-hp-bar');
            const botBar = document.getElementById('bot-hp-bar');
            const playerText = document.getElementById('player-hp-text');
            const botText = document.getElementById('bot-hp-text');
            
            playerBar.style.width = `${playerHP}%`;
            botBar.style.width = `${botHP}%`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –Ω–∏–∑–∫–æ–≥–æ HP
            if (playerHP <= 20) playerBar.classList.add('low');
            else playerBar.classList.remove('low');
            
            if (botHP <= 20) botBar.classList.add('low');
            else botBar.classList.remove('low');
            
            playerText.textContent = `${playerHP}/100 HP`;
            botText.textContent = `${botHP}/100 HP`;
        }

        function endBattle() {
            battleInProgress = false;
            const resultDiv = document.getElementById('battle-result');
            const rewardDiv = document.getElementById('reward-info');
            const log = document.getElementById('battle-log');
            
            // –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à–∞–Ω—Å –ø–æ–±–µ–¥—ã –±–æ—Ç–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ (55% –∏–≥—Ä–æ–∫, 45% –±–æ—Ç)
            const playerWins = playerHP > 0;
            const adjustedResult = playerWins && Math.random() < 0.1; // 10% —à–∞–Ω—Å "–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ" –ø–æ—Ä–∞–∂–µ–Ω–∏—è
            
            if (playerHP <= 0 || adjustedResult) {
                resultDiv.textContent = 'üíÄ –ü–û–†–ê–ñ–ï–ù–ò–ï!';
                resultDiv.className = 'battle-result lose';
                log.textContent = '–í—ã –ø–æ—Ç–µ—Ä–ø–µ–ª–∏ —Å–æ–∫—Ä—É—à–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ...';
                
                if (activeBattleNft) {
                    collection = collection.filter(nft => 
                        nft.name !== activeBattleNft.name || nft.img !== activeBattleNft.img
                    );
                    activeBattleNft = null;
                    localStorage.removeItem('activeBattleNft');
                    localStorage.setItem('collection', JSON.stringify(collection));
                    rewardDiv.innerHTML = `<i class="fas fa-times-circle" style="color: #f44336;"></i> –í–∞—à NFT –∑–∞—Ö–≤–∞—á–µ–Ω –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–º!`;
                }
            } else {
                resultDiv.textContent = 'üèÜ –ü–û–ë–ï–î–ê!';
                resultDiv.className = 'battle-result win';
                log.textContent = '–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø–æ–±–µ–¥–∞! –í—ã –æ–∫–∞–∑–∞–ª–∏—Å—å —Å–∏–ª—å–Ω–µ–µ!';
                
                const rewardNft = { ...botNft, buyPrice: nftPrices[nftTemplates.findIndex(t => t.name === botNft.name)] };
                collection.push(rewardNft);
                localStorage.setItem('collection', JSON.stringify(collection));
                rewardDiv.innerHTML = `<i class="fas fa-trophy" style="color: #ffd700;"></i> –í—ã –ø–æ–ª—É—á–∏–ª–∏ NFT: ${botNft.name}!`;
            }
            
            resultDiv.style.display = 'block';
            rewardDiv.style.display = 'block';
            
            setTimeout(() => {
                switchScreen('main');
                updateUI();
            }, 4000);
        }

        function renderCenterArea() {
            const centerDiv = document.getElementById('center-content');
            centerDiv.innerHTML = '';
            if (activeBattleNft) {
                centerDiv.innerHTML = `
                    <img src="${activeBattleNft.img}" class="center-nft-img" alt="${activeBattleNft.name}">
                    <div class="center-nft-name">${activeBattleNft.name}</div>
                    <div class="center-nft-status">–ì–æ—Ç–æ–≤ –∫ –±–∏—Ç–≤–µ</div>
                `;
            } else {
                centerDiv.innerHTML = '<div class="center-logo">‚öîÔ∏è</div>';
            }
        }

        function renderCollection() {
            const grid = document.getElementById('collection-grid');
            grid.innerHTML = '';
            
            if (collection.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #888888;">–ö–æ–ª–ª–µ–∫—Ü–∏—è –ø—É—Å—Ç–∞<br>–ö—É–ø–∏—Ç–µ NFT –≤ –º–∞–≥–∞–∑–∏–Ω–µ</div>';
            } else {
                collection.forEach((nft, index) => {
                    const isActive = activeBattleNft && activeBattleNft.name === nft.name && activeBattleNft.img === nft.img;
                    const card = document.createElement('div');
                    card.className = 'nft-card';
                    card.innerHTML = `
                        <img src="${nft.img}" class="nft-card-img" alt="${nft.name}">
                        <div class="nft-card-name">${nft.name} ${isActive ? '‚öîÔ∏è' : ''}</div>
                        <div class="nft-card-price">–ö—É–ø–ª–µ–Ω–æ –∑–∞ ${nft.buyPrice}‚≠ê</div>
                        <button class="nft-card-btn" onclick="setToBattle(${index})" ${isActive ? 'disabled' : ''}>
                            ${isActive ? '–í –±–∏—Ç–≤–µ' : '–í –±–∏—Ç–≤—É'}
                        </button>
                        <button class="nft-card-btn secondary" onclick="sellNft(${index})">
                            –ü—Ä–æ–¥–∞—Ç—å ${Math.floor(nft.buyPrice * 0.8)}‚≠ê
                        </button>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            
            nftTemplates.forEach((template, index) => {
                const price = nftPrices[index];
                const card = document.createElement('div');
                card.className = 'nft-card';
                card.innerHTML = `
                    <img src="${template.img}" class="nft-card-img" alt="${template.name}">
                    <div class="nft-card-name">${template.name}</div>
                    <div class="nft-card-price">${price} –∑–≤—ë–∑–¥</div>
                    <button class="nft-card-btn" onclick="buyNft(${index}, ${price})" ${stars < price ? 'disabled' : ''}>
                        ${stars < price ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        function renderProfile() {
            const grid = document.getElementById('profile-collection');
            grid.innerHTML = '';
            
            if (collection.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #888888;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç NFT</div>';
            } else {
                collection.forEach((nft) => {
                    const isActive = activeBattleNft && activeBattleNft.name === nft.name && activeBattleNft.img === nft.img;
                    const card = document.createElement('div');
                    card.className = 'nft-card';
                    card.innerHTML = `
                        <img src="${nft.img}" class="nft-card-img" alt="${nft.name}">
                        <div class="nft-card-name">${nft.name} ${isActive ? '‚öîÔ∏è' : ''}</div>
                        <div class="nft-card-price">–°—Ç–æ–∏–º–æ—Å—Ç—å: ${nft.buyPrice}‚≠ê</div>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        function buyNft(templateIndex, price) {
            if (stars >= price) {
                stars -= price;
                const nft = { ...nftTemplates[templateIndex], buyPrice: price };
                collection.push(nft);
                updateUI();
                alert(`–ö—É–ø–ª–µ–Ω ${nft.name}!`);
                renderShop();
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
            }
        }

        function sellNft(index) {
            const nft = collection[index];
            const sellPrice = Math.floor(nft.buyPrice * 0.8);
            stars += sellPrice;
            
            if (activeBattleNft && activeBattleNft.name === nft.name && activeBattleNft.img === nft.img) {
                activeBattleNft = null;
                localStorage.removeItem('activeBattleNft');
            }
            
            collection.splice(index, 1);
            updateUI();
            renderCollection();
            renderCenterArea();
            alert(`–ü—Ä–æ–¥–∞–Ω –∑–∞ ${sellPrice} –∑–≤—ë–∑–¥!`);
        }

        function setToBattle(index) {
            activeBattleNft = collection[index];
            localStorage.setItem('activeBattleNft', JSON.stringify(activeBattleNft));
            renderCollection();
            renderCenterArea();
            updateUI();
            alert(`NFT ${activeBattleNft.name} –≥–æ—Ç–æ–≤ –∫ –±–∏—Ç–≤–µ!`);
        }
    </script>
</body>
</html>